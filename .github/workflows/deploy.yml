name: Deploy
on:
  push:
    branches:
      - master
jobs:
  deploy:
    runs-on: macos-10.15
    steps:
      - name: "ğŸ“¥ Check-out"
        uses: actions/checkout@v1
      - name: "ğŸ§° Install JDK"
        uses: actions/setup-java@v3
        with:
          java-version: 1.8
          java-package: jdk
      - name: "ğŸ§° Install Android SDK"
        uses: android-actions/setup-android@v2
      - name: "ğŸ•¶ Decrypt secret files"
        run: |
          cd secret
          gpg --quiet --batch --yes --decrypt --passphrase="${{ secrets.FILES_PASSPHRASE }}" --output secrets.tar secrets.tar.gpg
          tar -xf secrets.tar
      - name: "ğŸ“ Copy local CI properties"
        run: cp ci/local.properties ./
      - name: "ğŸ— Build"
        run: ./gradlew assembleDebug
      - name: "ğŸš€ GitHub release"
        run: ./gradlew githubRelease
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: "ğŸš€ Google Play publish"
        run: ./gradlew publishRelease
